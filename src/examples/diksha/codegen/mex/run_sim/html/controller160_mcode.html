<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="64,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T3U3">F</span>, <span class="var type1" id="S3T4U4">M</span>] = controller(<span class="var type1" id="S4T4U7">posc</span>, <span class="var type1" id="S5T4U8">velc</span>, <span class="var type1" id="S6T4U9">rotc</span>, <span class="var type1" id="S7T4U10">omegac</span> , <span class="var type1" id="S8T4U11">posd</span>, <span class="var type1" id="S9T4U12">veld</span>, <span class="var type1" id="S10T4U13">rotd</span>, <span class="var type1" id="S11T4U14">omegad</span>, <span class="var type1" id="S12T5U15">controld</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="64,2" id="srcline2"> 2</a></span><span class="line">coder.inline(<span class="string">'never'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="64,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%desired inputs:[xd yd zd xd_dot yd_dot zd_dot phid thetad psid phidotd thetadotd psidotd ud(1)---Tfwd</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%ud(2)---Mfwd</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T3:U12"><span class="var type1" id="S14T3U24">BQ_m</span>=<span class="mxinfo " id="T3:U14">12</span></span>;<span class="comment">%kg</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T3:U15"><span class="var type1" id="S15T3U28">BQ_g</span>=<span class="mxinfo " id="T3:U17">9.81</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T26:U18"><span class="var type1" id="S16T26U32">BQ_J</span>=<span class="mxinfo " id="T26:U20">[1.86 0 0;</span></span>
<span class="srcline"><span class="lineno"><a href="64,8" id="srcline8"> 8</a></span><span class="line">    0 2.031 0;</span></span>
<span class="srcline"><span class="lineno"><a href="64,9" id="srcline9"> 9</a></span><span class="line">    0 0 3.617]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T5:U21"><span class="var type1" id="S17T5U48">ud</span>=<span class="var type1" id="S12T5U49">controld</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T4:U24"><span class="var type1" id="S18T4U52">omega_curr</span>=<span class="mxinfo " id="T4:U26"><span class="mxinfo " id="T26:U27">[<span class="mxinfo " id="T6:U28"><span class="mxinfo " id="T3:U29">1</span> <span class="mxinfo " id="T3:U30">0</span> <span class="mxinfo " id="T3:U31">-<span class="mxinfo " id="T3:U32">sin(<span class="mxinfo " id="T3:U33"><span class="var type1" id="S6T4U62">rotc</span>(<span class="mxinfo " id="T14:U35">2</span>)</span>)</span></span></span>;<span class="mxinfo " id="T6:U36"><span class="mxinfo " id="T3:U37">0</span> <span class="mxinfo " id="T3:U38">cos(<span class="mxinfo " id="T3:U39"><span class="var type1" id="S6T4U69">rotc</span>(<span class="mxinfo " id="T14:U41">3</span>)</span>)</span> <span class="mxinfo " id="T3:U42"><span class="mxinfo " id="T3:U43">cos(<span class="mxinfo " id="T3:U44"><span class="var type1" id="S6T4U75">rotc</span>(<span class="mxinfo " id="T14:U46">2</span>)</span>)</span>*<span class="mxinfo " id="T3:U47">sin(<span class="mxinfo " id="T3:U48"><span class="var type1" id="S6T4U80">rotc</span>(<span class="mxinfo " id="T14:U50">3</span>)</span>)</span></span></span>;<span class="mxinfo " id="T6:U51"><span class="mxinfo " id="T3:U52">0</span> <span class="mxinfo " id="T3:U53">-<span class="mxinfo " id="T3:U54">sin(<span class="mxinfo " id="T3:U55"><span class="var type1" id="S6T4U88">rotc</span>(<span class="mxinfo " id="T14:U57">3</span>)</span>)</span></span> <span class="mxinfo " id="T3:U58"><span class="mxinfo " id="T3:U59">cos(<span class="mxinfo " id="T3:U60"><span class="var type1" id="S6T4U94">rotc</span>(<span class="mxinfo " id="T14:U62">2</span>)</span>)</span>*<span class="mxinfo " id="T3:U63">cos(<span class="mxinfo " id="T3:U64"><span class="var type1" id="S6T4U99">rotc</span>(<span class="mxinfo " id="T14:U66">3</span>)</span>)</span></span></span>]</span>*<span class="mxinfo " id="T4:U67">[<span class="mxinfo " id="T3:U68"><span class="var type1" id="S7T4U104">omegac</span>(<span class="mxinfo " id="T14:U70">3</span>)</span>; <span class="mxinfo " id="T3:U71"><span class="var type1" id="S7T4U108">omegac</span>(<span class="mxinfo " id="T14:U73">2</span>)</span>; <span class="mxinfo " id="T3:U74"><span class="var type1" id="S7T4U112">omegac</span>(<span class="mxinfo " id="T14:U76">1</span>)</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T4:U77"><span class="var type1" id="S21T4U116">omega_des</span>=<span class="mxinfo " id="T4:U79"><span class="mxinfo " id="T26:U80">[<span class="mxinfo " id="T6:U81"><span class="mxinfo " id="T3:U82">1</span> <span class="mxinfo " id="T3:U83">0</span> <span class="mxinfo " id="T3:U84">-<span class="mxinfo " id="T3:U85">sin(<span class="mxinfo " id="T3:U86"><span class="var type1" id="S10T4U126">rotd</span>(<span class="mxinfo " id="T14:U88">2</span>)</span>)</span></span></span>;<span class="mxinfo " id="T6:U89"><span class="mxinfo " id="T3:U90">0</span> <span class="mxinfo " id="T3:U91">cos(<span class="mxinfo " id="T3:U92"><span class="var type1" id="S10T4U133">rotd</span>(<span class="mxinfo " id="T14:U94">3</span>)</span>)</span> <span class="mxinfo " id="T3:U95"><span class="mxinfo " id="T3:U96">cos(<span class="mxinfo " id="T3:U97"><span class="var type1" id="S10T4U139">rotd</span>(<span class="mxinfo " id="T14:U99">2</span>)</span>)</span>*<span class="mxinfo " id="T3:U100">sin(<span class="mxinfo " id="T3:U101"><span class="var type1" id="S10T4U144">rotd</span>(<span class="mxinfo " id="T14:U103">3</span>)</span>)</span></span></span>;<span class="mxinfo " id="T6:U104"><span class="mxinfo " id="T3:U105">0</span> <span class="mxinfo " id="T3:U106">-<span class="mxinfo " id="T3:U107">sin(<span class="mxinfo " id="T3:U108"><span class="var type1" id="S10T4U152">rotd</span>(<span class="mxinfo " id="T14:U110">3</span>)</span>)</span></span> <span class="mxinfo " id="T3:U111"><span class="mxinfo " id="T3:U112">cos(<span class="mxinfo " id="T3:U113"><span class="var type1" id="S10T4U158">rotd</span>(<span class="mxinfo " id="T14:U115">2</span>)</span>)</span>*<span class="mxinfo " id="T3:U116">cos(<span class="mxinfo " id="T3:U117"><span class="var type1" id="S10T4U163">rotd</span>(<span class="mxinfo " id="T14:U119">3</span>)</span>)</span></span></span>]</span>*<span class="mxinfo " id="T4:U120">[<span class="mxinfo " id="T3:U121"><span class="var type1" id="S11T4U168">omegad</span>(<span class="mxinfo " id="T14:U123">3</span>)</span>; <span class="mxinfo " id="T3:U124"><span class="var type1" id="S11T4U172">omegad</span>(<span class="mxinfo " id="T14:U126">2</span>)</span>; <span class="mxinfo " id="T3:U127"><span class="var type1" id="S11T4U176">omegad</span>(<span class="mxinfo " id="T14:U129">1</span>)</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T26:U130"><span class="var type1" id="S22T26U180">kp</span>=<span class="mxinfo " id="T26:U132">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T3:U133"><span class="mxinfo " id="T3:U134"><span class="var type1" id="S22T26U187">kp</span>(<span class="mxinfo " id="T14:U136">1</span>,<span class="mxinfo " id="T14:U137">1</span>)</span>=<span class="mxinfo " id="T3:U138">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T3:U139"><span class="mxinfo " id="T3:U140"><span class="var type1" id="S22T26U194">kp</span>(<span class="mxinfo " id="T14:U142">2</span>,<span class="mxinfo " id="T14:U143">2</span>)</span>=<span class="mxinfo " id="T3:U144">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T3:U145"><span class="mxinfo " id="T3:U146"><span class="var type1" id="S22T26U201">kp</span>(<span class="mxinfo " id="T14:U148">3</span>,<span class="mxinfo " id="T14:U149">3</span>)</span>=<span class="mxinfo " id="T3:U150">50</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,19" id="srcline19">19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T26:U151"><span class="var type1" id="S24T26U207">kv</span>=<span class="mxinfo " id="T26:U153">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T3:U154"><span class="mxinfo " id="T3:U155"><span class="var type1" id="S24T26U214">kv</span>(<span class="mxinfo " id="T14:U157">1</span>,<span class="mxinfo " id="T14:U158">1</span>)</span>=<span class="mxinfo " id="T3:U159">50</span></span>;     </span></span>
<span class="srcline"><span class="lineno"><a href="64,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo " id="T3:U160"><span class="mxinfo " id="T3:U161"><span class="var type1" id="S24T26U221">kv</span>(<span class="mxinfo " id="T14:U163">2</span>,<span class="mxinfo " id="T14:U164">2</span>)</span>=<span class="mxinfo " id="T3:U165">6</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T3:U166"><span class="mxinfo " id="T3:U167"><span class="var type1" id="S24T26U228">kv</span>(<span class="mxinfo " id="T14:U169">3</span>,<span class="mxinfo " id="T14:U170">3</span>)</span>=<span class="mxinfo " id="T3:U171">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo " id="T26:U172"><span class="var type1" id="S25T26U234">kr</span>=<span class="mxinfo " id="T26:U174">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T3:U175"><span class="mxinfo " id="T3:U176"><span class="var type1" id="S25T26U241">kr</span>(<span class="mxinfo " id="T14:U178">1</span>,<span class="mxinfo " id="T14:U179">1</span>)</span>=<span class="mxinfo " id="T3:U180">3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo " id="T3:U181"><span class="mxinfo " id="T3:U182"><span class="var type1" id="S25T26U248">kr</span>(<span class="mxinfo " id="T14:U184">2</span>,<span class="mxinfo " id="T14:U185">2</span>)</span>=<span class="mxinfo " id="T3:U186">100</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo " id="T3:U187"><span class="mxinfo " id="T3:U188"><span class="var type1" id="S25T26U255">kr</span>(<span class="mxinfo " id="T14:U190">3</span>,<span class="mxinfo " id="T14:U191">3</span>)</span>=<span class="mxinfo " id="T3:U192">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T26:U193"><span class="var type1" id="S26T26U261">kw</span>=<span class="mxinfo " id="T26:U195">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T3:U196"><span class="mxinfo " id="T3:U197"><span class="var type1" id="S26T26U268">kw</span>(<span class="mxinfo " id="T14:U199">1</span>,<span class="mxinfo " id="T14:U200">1</span>)</span>=<span class="mxinfo " id="T3:U201">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T3:U202"><span class="mxinfo " id="T3:U203"><span class="var type1" id="S26T26U275">kw</span>(<span class="mxinfo " id="T14:U205">2</span>,<span class="mxinfo " id="T14:U206">2</span>)</span>=<span class="mxinfo " id="T3:U207">1500</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo " id="T3:U208"><span class="mxinfo " id="T3:U209"><span class="var type1" id="S26T26U282">kw</span>(<span class="mxinfo " id="T14:U211">3</span>,<span class="mxinfo " id="T14:U212">3</span>)</span>=<span class="mxinfo " id="T3:U213">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,35" id="srcline35">35</a></span><span class="line"><span class="mxinfo " id="T26:U214"><span class="var type1" id="S27T26U288">Rb</span>=<span class="mxinfo " id="T26:U216"><span class="fcn" id="F76N6:B290">eul2rotm</span>(<span class="var type1" id="S6T4U291">rotc</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo " id="T26:U218"><span class="var type1" id="S29T26U294">R</span>=<span class="mxinfo " id="T26:U220"><span class="fcn" id="F76N6:B296">eul2rotm</span>(<span class="var type1" id="S10T4U297">rotd</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo " id="T4:U222"><span class="var type1" id="S30T4U300">Fa</span>=<span class="mxinfo " id="T4:U224"><span class="fcn" id="F104N2:B302">AeroFEst</span>(<span class="mxinfo " id="T6:U225">[<span class="mxinfo " id="T3:U226">0</span> <span class="mxinfo " id="T3:U227"><span class="var type1" id="S6T4U307">rotc</span>(<span class="mxinfo " id="T14:U229">2</span>)</span> <span class="mxinfo " id="T3:U230">0</span>]</span>,<span class="mxinfo " id="T4:U231">[<span class="mxinfo " id="T3:U232"><span class="var type1" id="S5T4U313">velc</span>(<span class="mxinfo " id="T14:U234">1</span>)</span>;<span class="mxinfo " id="T3:U235">0</span>;<span class="mxinfo " id="T3:U236"><span class="var type1" id="S5T4U319">velc</span>(<span class="mxinfo " id="T14:U238">3</span>)</span>]</span>,<span class="var type1" id="S18T4U321">omega_curr</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo " id="T4:U240"><span class="var type1" id="S32T4U324">acc_net</span>=<span class="mxinfo " id="T4:U242"><span class="mxinfo " id="T4:U243"><span class="mxinfo " id="T4:U244"><span class="mxinfo " id="T4:U245">(<span class="mxinfo " id="T4:U246">(<span class="mxinfo " id="T4:U247"><span class="var type1" id="S29T26U333">R</span>*<span class="mxinfo " id="T4:U249">[<span class="mxinfo " id="T3:U250">0</span>;<span class="mxinfo " id="T3:U251">0</span>;<span class="mxinfo " id="T3:U252"><span class="var type1" id="S17T5U341">ud</span>(<span class="mxinfo " id="T14:U254">1</span>)</span>]</span></span>)/<span class="var type1" id="S14T3U343">BQ_m</span></span>)+<span class="mxinfo " id="T4:U256"><span class="var type1" id="S22T26U345">kp</span>*<span class="mxinfo " id="T4:U258">[<span class="mxinfo " id="T3:U259">0</span>;<span class="mxinfo " id="T3:U260">0</span>;(<span class="mxinfo " id="T3:U261"><span class="mxinfo " id="T3:U262"><span class="var type1" id="S8T4U355">posd</span>(<span class="mxinfo " id="T14:U264">3</span>)</span>-<span class="mxinfo " id="T3:U265"><span class="var type1" id="S4T4U358">posc</span>(<span class="mxinfo " id="T3:U267">3</span>)</span></span>)]</span></span></span>+<span class="mxinfo " id="T4:U268"><span class="var type1" id="S24T26U361">kv</span>*<span class="mxinfo " id="T4:U270">[(<span class="mxinfo " id="T3:U271"><span class="mxinfo " id="T3:U272"><span class="var type1" id="S9T4U367">veld</span>(<span class="mxinfo " id="T14:U274">1</span>)</span>-<span class="mxinfo " id="T3:U275"><span class="var type1" id="S5T4U370">velc</span>(<span class="mxinfo " id="T3:U277">1</span>)</span></span>);<span class="mxinfo " id="T3:U278">-<span class="mxinfo " id="T3:U279"><span class="var type1" id="S5T4U375">velc</span>(<span class="mxinfo " id="T14:U281">2</span>)</span></span>;(<span class="mxinfo " id="T3:U282"><span class="mxinfo " id="T3:U283"><span class="var type1" id="S9T4U381">veld</span>(<span class="mxinfo " id="T14:U285">3</span>)</span>-<span class="mxinfo " id="T3:U286"><span class="var type1" id="S5T4U384">velc</span>(<span class="mxinfo " id="T3:U288">3</span>)</span></span>)]</span></span></span>+<span class="mxinfo " id="T4:U289">[<span class="mxinfo " id="T3:U290">0</span>; <span class="mxinfo " id="T3:U291">0</span>; <span class="var type1" id="S15T3U392">BQ_g</span>]</span></span>-(<span class="mxinfo " id="T4:U293">(<span class="mxinfo " id="T4:U294"><span class="var type1" id="S27T26U397">Rb</span>*<span class="var type1" id="S30T4U398">Fa</span></span>)/(<span class="var type1" id="S14T3U400">BQ_m</span>)</span>)</span></span>; <span class="comment">% acc_net</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,41" id="srcline41">41</a></span><span class="line"><span class="comment">% calculation of current euler angles</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo " id="T4:U298"><span class="var type1" id="S33T4U403">b3</span>=<span class="mxinfo " id="T4:U300"><span class="var type1" id="S32T4U405">acc_net</span>/<span class="mxinfo " id="T3:U302">norm(<span class="var type1" id="S32T4U408">acc_net</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,43" id="srcline43">43</a></span><span class="line"><span class="mxinfo " id="T4:U304"><span class="var type1" id="S35T4U411">c2</span>=<span class="mxinfo " id="T4:U306"><span class="mxinfo " id="T6:U307">[<span class="mxinfo " id="T3:U308">-<span class="mxinfo " id="T3:U309">sin(<span class="mxinfo " id="T3:U310"><span class="var type1" id="S10T4U419">rotd</span>(<span class="mxinfo " id="T14:U312">1</span>)</span>)</span></span> <span class="mxinfo " id="T3:U313">cos(<span class="mxinfo " id="T3:U314"><span class="var type1" id="S10T4U424">rotd</span>(<span class="mxinfo " id="T14:U316">1</span>)</span>)</span> <span class="mxinfo " id="T3:U317">0</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,44" id="srcline44">44</a></span><span class="line"><span class="mxinfo " id="T4:U318"><span class="var type1" id="S36T4U429">b1</span>=<span class="mxinfo " id="T4:U320"><span class="mxinfo " id="T4:U321">cross(<span class="var type1" id="S35T4U433">c2</span>,<span class="var type1" id="S33T4U434">b3</span>)</span>/<span class="mxinfo " id="T3:U324">norm(<span class="mxinfo " id="T4:U325">cross(<span class="var type1" id="S35T4U439">c2</span>,<span class="var type1" id="S33T4U440">b3</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,45" id="srcline45">45</a></span><span class="line"><span class="mxinfo " id="T4:U328"><span class="var type1" id="S38T4U443">b2</span>=<span class="mxinfo " id="T4:U330">cross(<span class="var type1" id="S33T4U446">b3</span>,<span class="var type1" id="S36T4U447">b1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,46" id="srcline46">46</a></span><span class="line"><span class="mxinfo " id="T26:U333"><span class="var type1" id="S39T26U450">Rd</span>=<span class="mxinfo " id="T26:U335">[<span class="var type1" id="S36T4U453">b1</span> <span class="var type1" id="S38T4U454">b2</span> <span class="var type1" id="S33T4U455">b3</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,47" id="srcline47">47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,48" id="srcline48">48</a></span><span class="line"><span class="comment">%thrust control input</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,49" id="srcline49">49</a></span><span class="line"><span class="mxinfo " id="T3:U339"><span class="var type1" id="S40T3U458">flag</span>=<span class="mxinfo " id="T3:U341">sign(<span class="mxinfo " id="T3:U342"><span class="mxinfo " id="T6:U343"><span class="mxinfo " id="T6:U344">[0 0 1]</span>*<span class="mxinfo " id="T26:U345"><span class="var type1" id="S27T26U469">Rb</span>'</span></span>*<span class="var type1" id="S32T4U470">acc_net</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,50" id="srcline50">50</a></span><span class="line"><span class="mxinfo " id="T3:U348"><span class="var type1" id="S2T3U473">F</span>=<span class="mxinfo " id="T3:U350"><span class="var type1" id="S40T3U475">flag</span>*(<span class="mxinfo " id="T3:U352"><span class="var type1" id="S14T3U478">BQ_m</span>*<span class="mxinfo " id="T3:U354">norm(<span class="var type1" id="S32T4U481">acc_net</span>)</span></span>)</span></span>;           </span></span>
<span class="srcline"><span class="lineno"><a href="64,51" id="srcline51">51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,52" id="srcline52">52</a></span><span class="line"><span class="mxinfo " id="T26:U356"><span class="var type1" id="S29T26U484">R</span>=<span class="mxinfo " id="T26:U358"><span class="fcn" id="F76N6:B486">eul2rotm</span>(<span class="var type1" id="S6T4U487">rotc</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,53" id="srcline53">53</a></span><span class="line"><span class="mxinfo " id="T26:U360"><span class="var type1" id="S42T26U490">erm</span>=<span class="mxinfo " id="T26:U362"><span class="mxinfo " id="T3:U363">0.5</span>*(<span class="mxinfo " id="T26:U364">(<span class="mxinfo " id="T26:U365"><span class="mxinfo " id="T26:U366"><span class="var type1" id="S39T26U498">Rd</span>'</span>*<span class="var type1" id="S29T26U499">R</span></span>)-(<span class="mxinfo " id="T26:U369"><span class="mxinfo " id="T26:U370"><span class="var type1" id="S29T26U503">R</span>'</span>*<span class="var type1" id="S39T26U504">Rd</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,54" id="srcline54">54</a></span><span class="line"><span class="mxinfo " id="T4:U373"><span class="var type1" id="S43T4U507">er</span>=<span class="mxinfo " id="T4:U375">[<span class="mxinfo " id="T3:U376"><span class="var type1" id="S42T26U511">erm</span>(<span class="mxinfo " id="T14:U378">3</span>,<span class="mxinfo " id="T14:U379">2</span>)</span>;<span class="mxinfo " id="T3:U380"><span class="var type1" id="S42T26U516">erm</span>(<span class="mxinfo " id="T14:U382">1</span>,<span class="mxinfo " id="T14:U383">3</span>)</span>;<span class="mxinfo " id="T3:U384"><span class="var type1" id="S42T26U521">erm</span>(<span class="mxinfo " id="T14:U386">2</span>,<span class="mxinfo " id="T14:U387">1</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,55" id="srcline55">55</a></span><span class="line"><span class="mxinfo " id="T4:U388"><span class="var type1" id="S44T4U526">ew</span>=(<span class="mxinfo " id="T4:U390"><span class="var type1" id="S18T4U529">omega_curr</span>-(<span class="mxinfo " id="T4:U392">(<span class="mxinfo " id="T26:U393"><span class="mxinfo " id="T26:U394"><span class="var type1" id="S29T26U535">R</span>'</span>*<span class="var type1" id="S39T26U536">Rd</span></span>)*<span class="var type1" id="S21T4U537">omega_des</span></span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,56" id="srcline56">56</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,57" id="srcline57">57</a></span><span class="line"><span class="mxinfo " id="T4:U398"><span class="var type1" id="S45T4U540">tau_a</span>=<span class="mxinfo " id="T4:U400"><span class="fcn" id="F159N3:B542">AeroMEst</span>(<span class="mxinfo " id="T4:U401">[<span class="mxinfo " id="T3:U402">0</span>; <span class="mxinfo " id="T3:U403"><span class="var type1" id="S6T4U548">rotc</span>(<span class="mxinfo " id="T14:U405">2</span>)</span>; <span class="mxinfo " id="T3:U406">0</span>]</span>,<span class="mxinfo " id="T4:U407">[<span class="mxinfo " id="T3:U408"><span class="var type1" id="S5T4U555">velc</span>(<span class="mxinfo " id="T14:U410">1</span>)</span>;<span class="mxinfo " id="T3:U411">0</span>;<span class="mxinfo " id="T3:U412"><span class="var type1" id="S5T4U561">velc</span>(<span class="mxinfo " id="T14:U414">3</span>)</span>]</span>,<span class="var type1" id="S18T4U563">omega_curr</span>, <span class="var type1" id="S30T4U564">Fa</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,58" id="srcline58">58</a></span><span class="line"><span class="mxinfo " id="T4:U417"><span class="var type1" id="S3T4U567">M</span>=<span class="mxinfo " id="T4:U419"><span class="mxinfo " id="T4:U420"><span class="mxinfo " id="T4:U421"><span class="mxinfo " id="T4:U422"><span class="mxinfo " id="T4:U423"><span class="mxinfo " id="T4:U424">[<span class="mxinfo " id="T3:U425">0</span>;<span class="mxinfo " id="T3:U426"><span class="var type1" id="S17T5U578">ud</span>(<span class="mxinfo " id="T14:U428">2</span>)</span>;<span class="mxinfo " id="T3:U429">0</span>]</span>-<span class="mxinfo " id="T4:U430"><span class="var type1" id="S25T26U583">kr</span>*<span class="var type1" id="S43T4U584">er</span></span></span>-<span class="mxinfo " id="T4:U433"><span class="var type1" id="S26T26U586">kw</span>*<span class="var type1" id="S44T4U587">ew</span></span></span>+<span class="mxinfo " id="T4:U436">cross(<span class="var type1" id="S18T4U590">omega_curr</span>,<span class="mxinfo " id="T4:U438"><span class="var type1" id="S16T26U592">BQ_J</span>*<span class="var type1" id="S18T4U593">omega_curr</span></span>)</span></span>-<span class="mxinfo " id="T4:U441"><span class="var type1" id="S16T26U595">BQ_J</span>*<span class="mxinfo " id="T4:U443">cross(<span class="var type1" id="S44T4U598">ew</span>,<span class="mxinfo " id="T4:U445">(<span class="mxinfo " id="T26:U446"><span class="mxinfo " id="T26:U447"><span class="var type1" id="S29T26U603">R</span>'</span>*<span class="var type1" id="S39T26U604">Rd</span></span>)*<span class="var type1" id="S21T4U605">omega_des</span></span>)</span></span></span>-<span class="var type1" id="S45T4U606">tau_a</span></span></span>;    <span class="comment">%moment input</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,59" id="srcline59">59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,60" id="srcline60">60</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
