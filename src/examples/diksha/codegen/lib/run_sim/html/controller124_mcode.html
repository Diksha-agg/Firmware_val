<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="59,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T3U3">Thrust</span>, <span class="var type1" id="S3T4U4">M</span>] = controller(<span class="var type1" id="S4T4U7">posc</span>, <span class="var type1" id="S5T4U8">velc</span>, <span class="var type1" id="S6T4U9">rotc</span>, <span class="var type1" id="S7T4U10">omegac</span> , <span class="var type1" id="S8T4U11">posd</span>, <span class="var type1" id="S9T4U12">veld</span>, <span class="var type1" id="S10T4U13">rotd</span>, <span class="var type1" id="S11T4U14">omegad</span>, <span class="var type1" id="S12T5U15">controld</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="59,2" id="srcline2"> 2</a></span><span class="line">coder.inline(<span class="string">'never'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="59,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%desired inputs:[xd yd zd xd_dot yd_dot zd_dot phid thetad psid phidotd thetadotd psidotd ud(1)---Tfwd</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%ud(2)---Mfwd</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T3:U12"><span class="var type1" id="S2T3U24">Thrust</span>=<span class="mxinfo " id="T3:U14">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T3:U15"><span class="var type1" id="S14T3U28">BQ_m</span>=<span class="mxinfo " id="T3:U17">12</span></span>;<span class="comment">%kg</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T3:U18"><span class="var type1" id="S15T3U32">BQ_g</span>=<span class="mxinfo " id="T3:U20">9.81</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T27:U21"><span class="var type1" id="S16T27U36">BQ_J</span>=<span class="mxinfo " id="T27:U23">[1.86 0 0;</span></span>
<span class="srcline"><span class="lineno"><a href="59,9" id="srcline9"> 9</a></span><span class="line">    0 2.031 0;</span></span>
<span class="srcline"><span class="lineno"><a href="59,10" id="srcline10">10</a></span><span class="line">    0 0 3.617]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T5:U24"><span class="var type1" id="S17T5U52">ud</span>=<span class="var type1" id="S12T5U53">controld</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T4:U27"><span class="var type1" id="S18T4U56">omega_curr</span>=<span class="mxinfo " id="T4:U29"><span class="mxinfo " id="T27:U30">[<span class="mxinfo " id="T6:U31"><span class="mxinfo " id="T3:U32">1</span> <span class="mxinfo " id="T3:U33">0</span> <span class="mxinfo " id="T3:U34">-<span class="mxinfo " id="T3:U35">sin(<span class="mxinfo " id="T3:U36"><span class="var type1" id="S6T4U66">rotc</span>(<span class="mxinfo " id="T15:U38">2</span>)</span>)</span></span></span>;<span class="mxinfo " id="T6:U39"><span class="mxinfo " id="T3:U40">0</span> <span class="mxinfo " id="T3:U41">cos(<span class="mxinfo " id="T3:U42"><span class="var type1" id="S6T4U73">rotc</span>(<span class="mxinfo " id="T15:U44">3</span>)</span>)</span> <span class="mxinfo " id="T3:U45"><span class="mxinfo " id="T3:U46">cos(<span class="mxinfo " id="T3:U47"><span class="var type1" id="S6T4U79">rotc</span>(<span class="mxinfo " id="T15:U49">2</span>)</span>)</span>*<span class="mxinfo " id="T3:U50">sin(<span class="mxinfo " id="T3:U51"><span class="var type1" id="S6T4U84">rotc</span>(<span class="mxinfo " id="T15:U53">3</span>)</span>)</span></span></span>;<span class="mxinfo " id="T6:U54"><span class="mxinfo " id="T3:U55">0</span> <span class="mxinfo " id="T3:U56">-<span class="mxinfo " id="T3:U57">sin(<span class="mxinfo " id="T3:U58"><span class="var type1" id="S6T4U92">rotc</span>(<span class="mxinfo " id="T15:U60">3</span>)</span>)</span></span> <span class="mxinfo " id="T3:U61"><span class="mxinfo " id="T3:U62">cos(<span class="mxinfo " id="T3:U63"><span class="var type1" id="S6T4U98">rotc</span>(<span class="mxinfo " id="T15:U65">2</span>)</span>)</span>*<span class="mxinfo " id="T3:U66">cos(<span class="mxinfo " id="T3:U67"><span class="var type1" id="S6T4U103">rotc</span>(<span class="mxinfo " id="T15:U69">3</span>)</span>)</span></span></span>]</span>*<span class="mxinfo " id="T4:U70">[<span class="mxinfo " id="T3:U71"><span class="var type1" id="S7T4U108">omegac</span>(<span class="mxinfo " id="T15:U73">3</span>)</span>; <span class="mxinfo " id="T3:U74"><span class="var type1" id="S7T4U112">omegac</span>(<span class="mxinfo " id="T15:U76">2</span>)</span>; <span class="mxinfo " id="T3:U77"><span class="var type1" id="S7T4U116">omegac</span>(<span class="mxinfo " id="T15:U79">1</span>)</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T4:U80"><span class="var type1" id="S21T4U120">omega_des</span>=<span class="mxinfo " id="T4:U82"><span class="mxinfo " id="T27:U83">[<span class="mxinfo " id="T6:U84"><span class="mxinfo " id="T3:U85">1</span> <span class="mxinfo " id="T3:U86">0</span> <span class="mxinfo " id="T3:U87">-<span class="mxinfo " id="T3:U88">sin(<span class="mxinfo " id="T3:U89"><span class="var type1" id="S10T4U130">rotd</span>(<span class="mxinfo " id="T15:U91">2</span>)</span>)</span></span></span>;<span class="mxinfo " id="T6:U92"><span class="mxinfo " id="T3:U93">0</span> <span class="mxinfo " id="T3:U94">cos(<span class="mxinfo " id="T3:U95"><span class="var type1" id="S10T4U137">rotd</span>(<span class="mxinfo " id="T15:U97">3</span>)</span>)</span> <span class="mxinfo " id="T3:U98"><span class="mxinfo " id="T3:U99">cos(<span class="mxinfo " id="T3:U100"><span class="var type1" id="S10T4U143">rotd</span>(<span class="mxinfo " id="T15:U102">2</span>)</span>)</span>*<span class="mxinfo " id="T3:U103">sin(<span class="mxinfo " id="T3:U104"><span class="var type1" id="S10T4U148">rotd</span>(<span class="mxinfo " id="T15:U106">3</span>)</span>)</span></span></span>;<span class="mxinfo " id="T6:U107"><span class="mxinfo " id="T3:U108">0</span> <span class="mxinfo " id="T3:U109">-<span class="mxinfo " id="T3:U110">sin(<span class="mxinfo " id="T3:U111"><span class="var type1" id="S10T4U156">rotd</span>(<span class="mxinfo " id="T15:U113">3</span>)</span>)</span></span> <span class="mxinfo " id="T3:U114"><span class="mxinfo " id="T3:U115">cos(<span class="mxinfo " id="T3:U116"><span class="var type1" id="S10T4U162">rotd</span>(<span class="mxinfo " id="T15:U118">2</span>)</span>)</span>*<span class="mxinfo " id="T3:U119">cos(<span class="mxinfo " id="T3:U120"><span class="var type1" id="S10T4U167">rotd</span>(<span class="mxinfo " id="T15:U122">3</span>)</span>)</span></span></span>]</span>*<span class="mxinfo " id="T4:U123">[<span class="mxinfo " id="T3:U124"><span class="var type1" id="S11T4U172">omegad</span>(<span class="mxinfo " id="T15:U126">3</span>)</span>; <span class="mxinfo " id="T3:U127"><span class="var type1" id="S11T4U176">omegad</span>(<span class="mxinfo " id="T15:U129">2</span>)</span>; <span class="mxinfo " id="T3:U130"><span class="var type1" id="S11T4U180">omegad</span>(<span class="mxinfo " id="T15:U132">1</span>)</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T27:U133"><span class="var type1" id="S22T27U184">kp</span>=<span class="mxinfo " id="T27:U135">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T3:U136"><span class="mxinfo " id="T3:U137"><span class="var type1" id="S22T27U191">kp</span>(<span class="mxinfo " id="T15:U139">1</span>,<span class="mxinfo " id="T15:U140">1</span>)</span>=<span class="mxinfo " id="T3:U141">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T3:U142"><span class="mxinfo " id="T3:U143"><span class="var type1" id="S22T27U198">kp</span>(<span class="mxinfo " id="T15:U145">2</span>,<span class="mxinfo " id="T15:U146">2</span>)</span>=<span class="mxinfo " id="T3:U147">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T3:U148"><span class="mxinfo " id="T3:U149"><span class="var type1" id="S22T27U205">kp</span>(<span class="mxinfo " id="T15:U151">3</span>,<span class="mxinfo " id="T15:U152">3</span>)</span>=<span class="mxinfo " id="T3:U153">50</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,20" id="srcline20">20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T27:U154"><span class="var type1" id="S24T27U211">kv</span>=<span class="mxinfo " id="T27:U156">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo " id="T3:U157"><span class="mxinfo " id="T3:U158"><span class="var type1" id="S24T27U218">kv</span>(<span class="mxinfo " id="T15:U160">1</span>,<span class="mxinfo " id="T15:U161">1</span>)</span>=<span class="mxinfo " id="T3:U162">50</span></span>;     </span></span>
<span class="srcline"><span class="lineno"><a href="59,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T3:U163"><span class="mxinfo " id="T3:U164"><span class="var type1" id="S24T27U225">kv</span>(<span class="mxinfo " id="T15:U166">2</span>,<span class="mxinfo " id="T15:U167">2</span>)</span>=<span class="mxinfo " id="T3:U168">6</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo " id="T3:U169"><span class="mxinfo " id="T3:U170"><span class="var type1" id="S24T27U232">kv</span>(<span class="mxinfo " id="T15:U172">3</span>,<span class="mxinfo " id="T15:U173">3</span>)</span>=<span class="mxinfo " id="T3:U174">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T27:U175"><span class="var type1" id="S25T27U238">kr</span>=<span class="mxinfo " id="T27:U177">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo " id="T3:U178"><span class="mxinfo " id="T3:U179"><span class="var type1" id="S25T27U245">kr</span>(<span class="mxinfo " id="T15:U181">1</span>,<span class="mxinfo " id="T15:U182">1</span>)</span>=<span class="mxinfo " id="T3:U183">3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo " id="T3:U184"><span class="mxinfo " id="T3:U185"><span class="var type1" id="S25T27U252">kr</span>(<span class="mxinfo " id="T15:U187">2</span>,<span class="mxinfo " id="T15:U188">2</span>)</span>=<span class="mxinfo " id="T3:U189">100</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo " id="T3:U190"><span class="mxinfo " id="T3:U191"><span class="var type1" id="S25T27U259">kr</span>(<span class="mxinfo " id="T15:U193">3</span>,<span class="mxinfo " id="T15:U194">3</span>)</span>=<span class="mxinfo " id="T3:U195">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T27:U196"><span class="var type1" id="S26T27U265">kw</span>=<span class="mxinfo " id="T27:U198">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T3:U199"><span class="mxinfo " id="T3:U200"><span class="var type1" id="S26T27U272">kw</span>(<span class="mxinfo " id="T15:U202">1</span>,<span class="mxinfo " id="T15:U203">1</span>)</span>=<span class="mxinfo " id="T3:U204">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo " id="T3:U205"><span class="mxinfo " id="T3:U206"><span class="var type1" id="S26T27U279">kw</span>(<span class="mxinfo " id="T15:U208">2</span>,<span class="mxinfo " id="T15:U209">2</span>)</span>=<span class="mxinfo " id="T3:U210">1500</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo " id="T3:U211"><span class="mxinfo " id="T3:U212"><span class="var type1" id="S26T27U286">kw</span>(<span class="mxinfo " id="T15:U214">3</span>,<span class="mxinfo " id="T15:U215">3</span>)</span>=<span class="mxinfo " id="T3:U216">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo " id="T27:U217"><span class="var type1" id="S27T27U292">Rb</span>=<span class="mxinfo " id="T27:U219"><span class="fcn" id="F74N6:B294">eul2rotm</span>(<span class="var type1" id="S6T4U295">rotc</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,37" id="srcline37">37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo " id="T27:U221"><span class="var type1" id="S29T27U298">R</span>=<span class="mxinfo " id="T27:U223"><span class="fcn" id="F74N6:B300">eul2rotm</span>(<span class="var type1" id="S10T4U301">rotd</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo " id="T4:U225"><span class="var type1" id="S30T4U304">Fa</span>=<span class="mxinfo " id="T4:U227"><span class="fcn" id="F100N2:B306">AeroFEst</span>(<span class="mxinfo " id="T6:U228">[<span class="mxinfo " id="T3:U229">0</span> <span class="mxinfo " id="T3:U230"><span class="var type1" id="S6T4U311">rotc</span>(<span class="mxinfo " id="T15:U232">2</span>)</span> <span class="mxinfo " id="T3:U233">0</span>]</span>,<span class="mxinfo " id="T4:U234">[<span class="mxinfo " id="T3:U235"><span class="var type1" id="S5T4U317">velc</span>(<span class="mxinfo " id="T15:U237">1</span>)</span>;<span class="mxinfo " id="T3:U238">0</span>;<span class="mxinfo " id="T3:U239"><span class="var type1" id="S5T4U323">velc</span>(<span class="mxinfo " id="T15:U241">3</span>)</span>]</span>,<span class="var type1" id="S18T4U325">omega_curr</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,40" id="srcline40">40</a></span><span class="line"><span class="mxinfo " id="T4:U243"><span class="var type1" id="S32T4U328">acc_net</span>=<span class="mxinfo " id="T4:U245"><span class="mxinfo " id="T4:U246"><span class="mxinfo " id="T4:U247"><span class="mxinfo " id="T4:U248">(<span class="mxinfo " id="T4:U249">(<span class="mxinfo " id="T4:U250"><span class="var type1" id="S29T27U337">R</span>*<span class="mxinfo " id="T4:U252">[<span class="mxinfo " id="T3:U253">0</span>;<span class="mxinfo " id="T3:U254">0</span>;<span class="mxinfo " id="T3:U255"><span class="var type1" id="S17T5U345">ud</span>(<span class="mxinfo " id="T15:U257">1</span>)</span>]</span></span>)/<span class="var type1" id="S14T3U347">BQ_m</span></span>)+<span class="mxinfo " id="T4:U259"><span class="var type1" id="S22T27U349">kp</span>*<span class="mxinfo " id="T4:U261">[<span class="mxinfo " id="T3:U262">0</span>;<span class="mxinfo " id="T3:U263">0</span>;(<span class="mxinfo " id="T3:U264"><span class="mxinfo " id="T3:U265"><span class="var type1" id="S8T4U359">posd</span>(<span class="mxinfo " id="T15:U267">3</span>)</span>-<span class="mxinfo " id="T3:U268"><span class="var type1" id="S4T4U362">posc</span>(<span class="mxinfo " id="T3:U270">3</span>)</span></span>)]</span></span></span>+<span class="mxinfo " id="T4:U271"><span class="var type1" id="S24T27U365">kv</span>*<span class="mxinfo " id="T4:U273">[(<span class="mxinfo " id="T3:U274"><span class="mxinfo " id="T3:U275"><span class="var type1" id="S9T4U371">veld</span>(<span class="mxinfo " id="T15:U277">1</span>)</span>-<span class="mxinfo " id="T3:U278"><span class="var type1" id="S5T4U374">velc</span>(<span class="mxinfo " id="T3:U280">1</span>)</span></span>);<span class="mxinfo " id="T3:U281">-<span class="mxinfo " id="T3:U282"><span class="var type1" id="S5T4U379">velc</span>(<span class="mxinfo " id="T15:U284">2</span>)</span></span>;(<span class="mxinfo " id="T3:U285"><span class="mxinfo " id="T3:U286"><span class="var type1" id="S9T4U385">veld</span>(<span class="mxinfo " id="T15:U288">3</span>)</span>-<span class="mxinfo " id="T3:U289"><span class="var type1" id="S5T4U388">velc</span>(<span class="mxinfo " id="T3:U291">3</span>)</span></span>)]</span></span></span>+<span class="mxinfo " id="T4:U292">[<span class="mxinfo " id="T3:U293">0</span>; <span class="mxinfo " id="T3:U294">0</span>; <span class="var type1" id="S15T3U396">BQ_g</span>]</span></span>-(<span class="mxinfo " id="T4:U296">(<span class="mxinfo " id="T4:U297"><span class="var type1" id="S27T27U401">Rb</span>*<span class="var type1" id="S30T4U402">Fa</span></span>)/(<span class="var type1" id="S14T3U404">BQ_m</span>)</span>)</span></span>; <span class="comment">% acc_net</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,41" id="srcline41">41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,42" id="srcline42">42</a></span><span class="line"><span class="comment">% calculation of current euler angles</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,43" id="srcline43">43</a></span><span class="line"><span class="mxinfo " id="T4:U301"><span class="var type1" id="S33T4U407">b3</span>=<span class="mxinfo " id="T4:U303"><span class="var type1" id="S32T4U409">acc_net</span>/<span class="mxinfo " id="T3:U305">norm(<span class="var type1" id="S32T4U412">acc_net</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,44" id="srcline44">44</a></span><span class="line"><span class="mxinfo " id="T4:U307"><span class="var type1" id="S35T4U415">c2</span>=<span class="mxinfo " id="T4:U309"><span class="mxinfo " id="T6:U310">[<span class="mxinfo " id="T3:U311">-<span class="mxinfo " id="T3:U312">sin(<span class="mxinfo " id="T3:U313"><span class="var type1" id="S10T4U423">rotd</span>(<span class="mxinfo " id="T15:U315">1</span>)</span>)</span></span> <span class="mxinfo " id="T3:U316">cos(<span class="mxinfo " id="T3:U317"><span class="var type1" id="S10T4U428">rotd</span>(<span class="mxinfo " id="T15:U319">1</span>)</span>)</span> <span class="mxinfo " id="T3:U320">0</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,45" id="srcline45">45</a></span><span class="line"><span class="mxinfo " id="T4:U321"><span class="var type1" id="S36T4U433">b1</span>=<span class="mxinfo " id="T4:U323"><span class="mxinfo " id="T4:U324">cross(<span class="var type1" id="S35T4U437">c2</span>,<span class="var type1" id="S33T4U438">b3</span>)</span>/<span class="mxinfo " id="T3:U327">norm(<span class="mxinfo " id="T4:U328">cross(<span class="var type1" id="S35T4U443">c2</span>,<span class="var type1" id="S33T4U444">b3</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,46" id="srcline46">46</a></span><span class="line"><span class="mxinfo " id="T4:U331"><span class="var type1" id="S38T4U447">b2</span>=<span class="mxinfo " id="T4:U333">cross(<span class="var type1" id="S33T4U450">b3</span>,<span class="var type1" id="S36T4U451">b1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,47" id="srcline47">47</a></span><span class="line"><span class="mxinfo " id="T27:U336"><span class="var type1" id="S39T27U454">Rd</span>=<span class="mxinfo " id="T27:U338">[<span class="var type1" id="S36T4U457">b1</span> <span class="var type1" id="S38T4U458">b2</span> <span class="var type1" id="S33T4U459">b3</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,48" id="srcline48">48</a></span><span class="line"><span class="mxinfo " id="T3:U342"><span class="var type1" id="S40T3U462">nm</span>=<span class="mxinfo " id="T3:U344">norm(<span class="var type1" id="S32T4U465">acc_net</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,49" id="srcline49">49</a></span><span class="line"><span class="comment">%thrust control input</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,50" id="srcline50">50</a></span><span class="line"><span class="comment">%flag=sign([0 0 1]*Rb'*acc_net);</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,51" id="srcline51">51</a></span><span class="line"><span class="mxinfo " id="T3:U346"><span class="var type1" id="S2T3U468">Thrust</span>=(<span class="mxinfo " id="T3:U348"><span class="var type1" id="S14T3U471">BQ_m</span>*<span class="var type1" id="S40T3U472">nm</span></span>)</span>;           </span></span>
<span class="srcline"><span class="lineno"><a href="59,52" id="srcline52">52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,53" id="srcline53">53</a></span><span class="line"><span class="mxinfo " id="T27:U351"><span class="var type1" id="S29T27U475">R</span>=<span class="mxinfo " id="T27:U353"><span class="fcn" id="F74N6:B477">eul2rotm</span>(<span class="var type1" id="S6T4U478">rotc</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,54" id="srcline54">54</a></span><span class="line"><span class="mxinfo " id="T27:U355"><span class="var type1" id="S41T27U481">erm</span>=<span class="mxinfo " id="T27:U357"><span class="mxinfo " id="T3:U358">0.5</span>*(<span class="mxinfo " id="T27:U359">(<span class="mxinfo " id="T27:U360"><span class="mxinfo " id="T27:U361"><span class="var type1" id="S39T27U489">Rd</span>'</span>*<span class="var type1" id="S29T27U490">R</span></span>)-(<span class="mxinfo " id="T27:U364"><span class="mxinfo " id="T27:U365"><span class="var type1" id="S29T27U494">R</span>'</span>*<span class="var type1" id="S39T27U495">Rd</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,55" id="srcline55">55</a></span><span class="line"><span class="mxinfo " id="T4:U368"><span class="var type1" id="S42T4U498">er</span>=<span class="mxinfo " id="T4:U370">[<span class="mxinfo " id="T3:U371"><span class="var type1" id="S41T27U502">erm</span>(<span class="mxinfo " id="T15:U373">3</span>,<span class="mxinfo " id="T15:U374">2</span>)</span>;<span class="mxinfo " id="T3:U375"><span class="var type1" id="S41T27U507">erm</span>(<span class="mxinfo " id="T15:U377">1</span>,<span class="mxinfo " id="T15:U378">3</span>)</span>;<span class="mxinfo " id="T3:U379"><span class="var type1" id="S41T27U512">erm</span>(<span class="mxinfo " id="T15:U381">2</span>,<span class="mxinfo " id="T15:U382">1</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,56" id="srcline56">56</a></span><span class="line"><span class="mxinfo " id="T4:U383"><span class="var type1" id="S43T4U517">ew</span>=(<span class="mxinfo " id="T4:U385"><span class="var type1" id="S18T4U520">omega_curr</span>-(<span class="mxinfo " id="T4:U387">(<span class="mxinfo " id="T27:U388"><span class="mxinfo " id="T27:U389"><span class="var type1" id="S29T27U526">R</span>'</span>*<span class="var type1" id="S39T27U527">Rd</span></span>)*<span class="var type1" id="S21T4U528">omega_des</span></span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,57" id="srcline57">57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,58" id="srcline58">58</a></span><span class="line"><span class="mxinfo " id="T4:U393"><span class="var type1" id="S44T4U531">tau_a</span>=<span class="mxinfo " id="T4:U395"><span class="fcn" id="F123N3:B533">AeroMEst</span>(<span class="mxinfo " id="T4:U396">[<span class="mxinfo " id="T3:U397">0</span>; <span class="mxinfo " id="T3:U398"><span class="var type1" id="S6T4U539">rotc</span>(<span class="mxinfo " id="T15:U400">2</span>)</span>; <span class="mxinfo " id="T3:U401">0</span>]</span>,<span class="mxinfo " id="T4:U402">[<span class="mxinfo " id="T3:U403"><span class="var type1" id="S5T4U546">velc</span>(<span class="mxinfo " id="T15:U405">1</span>)</span>;<span class="mxinfo " id="T3:U406">0</span>;<span class="mxinfo " id="T3:U407"><span class="var type1" id="S5T4U552">velc</span>(<span class="mxinfo " id="T15:U409">3</span>)</span>]</span>,<span class="var type1" id="S18T4U554">omega_curr</span>, <span class="var type1" id="S30T4U555">Fa</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,59" id="srcline59">59</a></span><span class="line"><span class="mxinfo " id="T4:U412"><span class="var type1" id="S3T4U558">M</span>=<span class="mxinfo " id="T4:U414"><span class="mxinfo " id="T4:U415"><span class="mxinfo " id="T4:U416"><span class="mxinfo " id="T4:U417"><span class="mxinfo " id="T4:U418"><span class="mxinfo " id="T4:U419">[<span class="mxinfo " id="T3:U420">0</span>;<span class="mxinfo " id="T3:U421"><span class="var type1" id="S17T5U569">ud</span>(<span class="mxinfo " id="T15:U423">2</span>)</span>;<span class="mxinfo " id="T3:U424">0</span>]</span>-<span class="mxinfo " id="T4:U425"><span class="var type1" id="S25T27U574">kr</span>*<span class="var type1" id="S42T4U575">er</span></span></span>-<span class="mxinfo " id="T4:U428"><span class="var type1" id="S26T27U577">kw</span>*<span class="var type1" id="S43T4U578">ew</span></span></span>+<span class="mxinfo " id="T4:U431">cross(<span class="var type1" id="S18T4U581">omega_curr</span>,<span class="mxinfo " id="T4:U433"><span class="var type1" id="S16T27U583">BQ_J</span>*<span class="var type1" id="S18T4U584">omega_curr</span></span>)</span></span>-<span class="mxinfo " id="T4:U436"><span class="var type1" id="S16T27U586">BQ_J</span>*<span class="mxinfo " id="T4:U438">cross(<span class="var type1" id="S43T4U589">ew</span>,<span class="mxinfo " id="T4:U440">(<span class="mxinfo " id="T27:U441"><span class="mxinfo " id="T27:U442"><span class="var type1" id="S29T27U594">R</span>'</span>*<span class="var type1" id="S39T27U595">Rd</span></span>)*<span class="var type1" id="S21T4U596">omega_des</span></span>)</span></span></span>-<span class="var type1" id="S44T4U597">tau_a</span></span></span>;    <span class="comment">%moment input</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,60" id="srcline60">60</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,61" id="srcline61">61</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
